---------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Notes/Logs/10_bui
> ld_panel.log
  log type:  text
 opened on:  20 Feb 2026, 10:11:19

. 
. * ----------------------------------------------------------------------
. * Load processed wide dataset
. * ----------------------------------------------------------------------
. use "${PROCESSED}/analysis_ready_processed.dta", clear

. 
. capture confirm variable hhidpn

. if _rc {
.     display as error "10_build_panel: hhidpn (panel id) not found in analysis_r
> eady_processed.dta."
.     log close
.     exit 0
. }

. 
. * Weight (optional)
. local wtvar "RwWTRESP"

. capture confirm variable `wtvar'

. local has_wt = (_rc == 0)

. local wopt ""

. if `has_wt' local wopt "[aw=`wtvar']"

. 
. * Year list for returns/income panel (even years where returns exist)
. local years "2002 2004 2006 2008 2010 2012 2014 2016 2018 2020 2022"

. 
. display "=== 10_build_panel: Defining panel variable groups from analysis_ready
> _processed.dta ==="
=== 10_build_panel: Defining panel variable groups from analysis_ready_processed.
> dta ===

. 
. * ----------------------------------------------------------------------
. * Required: raw returns (r1_annual_*, r4_annual_*, r5_annual_*) for panel basel
> ine (14)
. * Fail loudly if missing; do NOT silently continue.
. * ----------------------------------------------------------------------
. foreach stub in r1_annual r4_annual r5_annual {
  2.     capture unab rawlist : `stub'_*
  3.     if _rc {
  4.         display as error "10_build_panel: `stub'_* not found in analysis_rea
> dy_processed.dta."
  5.         display as error "  Run 02_compute_returns_income.do, 03_prep_contro
> ls.do, 04_processing_income.do, 05_processing_returns.do in order."
  6.         log close
  7.         exit 198
  8.     }
  9.     local n : word count `rawlist'
 10.     display "10_build_panel: `stub'_* present (`n' vars)"
 11. }
10_build_panel: r1_annual_* present (48 vars)
10_build_panel: r4_annual_* present (48 vars)
10_build_panel: r5_annual_* present (48 vars)

. 
. * ----------------------------------------------------------------------
. * Time-varying groups: stubs for reshape + explicit varlists for keep
. * ----------------------------------------------------------------------
. 
. * Returns: raw (r*_annual), win (r*_annual_win), w5 (r*_annual_w5) — raw requir
> ed for 14
. local ret_stubs ""

. local ret_vars  ""

. foreach s in r1_annual r1_annual_win r1_annual_w5 r4_annual r4_annual_win r4_an
> nual_w5 r5_annual r5_annual_win r5_annual_w5 {
  2.     capture unab tmp : `s'_*
  3.     if !_rc {
  4.         local ret_stubs "`ret_stubs' `s'_"
  5.         local ret_vars  "`ret_vars' `tmp'"
  6.     }
  7. }

. 
. * Deflated + winsorized income (levels and any final specs)
. local inc_stubs ""

. local inc_vars  ""

. foreach s in labor_income_real_win total_income_real_win {
  2.     capture unab tmp : `s'_*
  3.     if !_rc {
  4.         local inc_stubs "`inc_stubs' `s'_"
  5.         local inc_vars  "`inc_vars' `tmp'"
  6.     }
  7. }

. * Include any final log/residualized income series if present
. foreach s in ln_lab_inc_final ln_tot_inc_final ln_lab_inc_final_resid ln_tot_in
> c_final_resid {
  2.     capture unab tmp : `s'_*
  3.     if !_rc {
  4.         local inc_stubs "`inc_stubs' `s'_"
  5.         local inc_vars  "`inc_vars' `tmp'"
  6.     }
  7. }

. 
. * Wealth (levels)
. local wealth_stubs ""

. local wealth_vars  ""

. foreach s in wealth_core wealth_ira wealth_coreira wealth_total {
  2.     capture unab tmp : `s'_*
  3.     if !_rc {
  4.         local wealth_stubs "`wealth_stubs' `s'_"
  5.         local wealth_vars  "`wealth_vars' `tmp'"
  6.     }
  7. }

. * Shares for panel regressions (15 Spec 2): share_core, share_ira, share_res, s
> hare_debt_long, share_debt_other
. foreach s in share_core share_ira share_res share_debt_long share_debt_other {
  2.     capture unab tmp : `s'_*
  3.     if !_rc {
  4.         local wealth_stubs "`wealth_stubs' `s'_"
  5.         local wealth_vars  "`wealth_vars' `tmp'"
  6.     }
  7. }

. * Fallback: if share_ira_* missing but wealth_ira_* and gross_wealth_* exist, c
> onstruct share_ira = wealth_ira/gross_wealth
. capture unab _share_ira : share_ira_*

. if _rc {
.     foreach y of local years {
  2.         capture confirm variable wealth_ira_`y' gross_wealth_`y'
  3.         if !_rc {
  4.             gen double share_ira_`y' = wealth_ira_`y' / gross_wealth_`y' if 
> !missing(gross_wealth_`y') & gross_wealth_`y' >= 500
  5.         }
  6.     }
.     capture unab _share_ira : share_ira_*
.     if !_rc {
.         local wealth_stubs "`wealth_stubs' share_ira_"
.         local wealth_vars "`wealth_vars' `_share_ira'"
.         display "10_build_panel: constructed share_ira_* from wealth_ira/gross_
> wealth (fallback)"
.     }
. }

. * Wealth deciles for panel regressions (14): r1->wealth_core_d*, r4->wealth_cor
> eira_d*, r5->wealth_d*
. forvalues d = 2/10 {
  2.     foreach s in wealth_core_d`d' wealth_coreira_d`d' wealth_d`d' {
  3.         capture unab tmp : `s'_*
  4.         if !_rc {
  5.             local wealth_stubs "`wealth_stubs' `s'_"
  6.             local wealth_vars  "`wealth_vars' `tmp'"
  7.         }
  8.     }
  9. }

. * Core wave-specific controls
. local ctrl_stubs ""

. local ctrl_vars  ""

. * censreg (census region) created in 03; pop_trust and regional_trust by pop/re
> gion only (no region×pop)
. foreach s in age age_bin married inlbrf censreg pop_trust regional_trust {
  2.     capture unab tmp : `s'_*
  3.     if !_rc {
  4.         local ctrl_stubs "`ctrl_stubs' `s'_"
  5.         local ctrl_vars  "`ctrl_vars' `tmp'"
  6.     }
  7. }

. 
. * ----------------------------------------------------------------------
. * Time-invariant (or single-wave) controls: trust, finlit, demographics, 2020-o
> nly controls
. * ----------------------------------------------------------------------
. local tinv_vars ""

. foreach v in trust_others_2020 trust_social_security_2020 trust_medicare_2020 t
> rust_banks_2020 ///
>              trust_advisors_2020 trust_mutual_funds_2020 trust_insurance_2020 t
> rust_media_2020 ///
>              interest_2020 inflation_2020 risk_div_2020 ///
>              educ_yrs gender immigrant born_us race_eth ///
>              depression_2020 health_cond_2020 medicare_2020 medicaid_2020 life_
> ins_2020 beq_any_2020 ///
>              num_divorce_2020 num_widow_2020 population_2020 population_3bin_20
> 20 {
  2.     capture confirm variable `v'
  3.     if !_rc local tinv_vars "`tinv_vars' `v'"
  4. }

. 
. display "Returns stubs: `ret_stubs'"
Returns stubs:  r1_annual_ r1_annual_win_ r1_annual_w5_ r4_annual_ r4_annual_win_
>  r4_annual_w5_ r5_annual_ r5_annual_win_ r5_annual_w5_

. display "Income stubs:  `inc_stubs'"
Income stubs:   labor_income_real_win_ total_income_real_win_ ln_lab_inc_final_ l
> n_tot_inc_final_

. display "Wealth stubs:  `wealth_stubs'"
Wealth stubs:   wealth_core_ wealth_ira_ wealth_coreira_ wealth_total_ share_core
> _ share_ira_ share_res_ share_debt_long_ share_debt_other_ wealth_core_d2_ weal
> th_coreira_d2_ wealth_d2_ wealth_core_d3_ wealth_coreira_d3_ wealth_d3_ wealth_
> core_d4_ wealth_coreira_d4_ wealth_d4_ wealth_core_d5_ wealth_coreira_d5_ wealt
> h_d5_ wealth_core_d6_ wealth_coreira_d6_ wealth_d6_ wealth_core_d7_ wealth_core
> ira_d7_ wealth_d7_ wealth_core_d8_ wealth_coreira_d8_ wealth_d8_ wealth_core_d9
> _ wealth_coreira_d9_ wealth_d9_ wealth_core_d10_ wealth_coreira_d10_ wealth_d10
> _

. display "Control stubs: `ctrl_stubs'"
Control stubs:  age_ age_bin_ married_ inlbrf_ censreg_ pop_trust_ regional_trust
> _

. display "Time-invariant vars: `tinv_vars'"
Time-invariant vars:  trust_others_2020 trust_social_security_2020 trust_medicare
> _2020 trust_banks_2020 trust_advisors_2020 trust_mutual_funds_2020 trust_insura
> nce_2020 trust_media_2020 interest_2020 inflation_2020 risk_div_2020 educ_yrs g
> ender immigrant born_us race_eth depression_2020 health_cond_2020 medicare_2020
>  medicaid_2020 life_ins_2020 beq_any_2020 num_divorce_2020 num_widow_2020 popul
> ation_2020 population_3bin_2020

. 
. * ----------------------------------------------------------------------
. * Keep only variables needed for the panel reshape
. * ----------------------------------------------------------------------
. local base_keep "hhidpn"

. if `has_wt' local base_keep "`base_keep' `wtvar'"

. 
. keep `base_keep' `tinv_vars' `ret_vars' `inc_vars' `wealth_vars' `ctrl_vars'

. 
. * ----------------------------------------------------------------------
. * Reshape to long: person–year panel
. * ----------------------------------------------------------------------
. local long_stubs "`ret_stubs' `inc_stubs' `wealth_stubs' `ctrl_stubs'"

. 
. * If there are no stubs, abort gracefully
. if "`long_stubs'" == "" {
.     display as error "10_build_panel: No time-varying stubs found to reshape."
.     log close
.     exit 0
. }

. 
. display "=== 10_build_panel: Reshaping to long person–year panel ==="
=== 10_build_panel: Reshaping to long person–year panel ===

. reshape long `long_stubs', i(hhidpn) j(year)
(j = 2000 2002 2004 2006 2008 2010 2012 2014 2016 2018 2020 2022)
(variable r1_annual_2000 not found)
(variable r1_annual_win_2000 not found)
(variable r1_annual_w5_2000 not found)
(variable r4_annual_2000 not found)
(variable r4_annual_win_2000 not found)
(variable r4_annual_w5_2000 not found)
(variable r5_annual_2000 not found)
(variable r5_annual_win_2000 not found)
(variable r5_annual_w5_2000 not found)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations           45,234   ->   542,808     
Number of variables                 937   ->   331         
j variable (12 values)                    ->   year
xij variables:
r1_annual_2000 r1_annual_2002 ... r1_annual_2022->r1_annual_
r1_annual_win_2000 r1_annual_win_2002 ... r1_annual_win_2022->r1_annual_win_
r1_annual_w5_2000 r1_annual_w5_2002 ... r1_annual_w5_2022->r1_annual_w5_
r4_annual_2000 r4_annual_2002 ... r4_annual_2022->r4_annual_
r4_annual_win_2000 r4_annual_win_2002 ... r4_annual_win_2022->r4_annual_win_
r4_annual_w5_2000 r4_annual_w5_2002 ... r4_annual_w5_2022->r4_annual_w5_
r5_annual_2000 r5_annual_2002 ... r5_annual_2022->r5_annual_
r5_annual_win_2000 r5_annual_win_2002 ... r5_annual_win_2022->r5_annual_win_
r5_annual_w5_2000 r5_annual_w5_2002 ... r5_annual_w5_2022->r5_annual_w5_
labor_income_real_win_2000 labor_income_real_win_2002 ... labor_income_real_win_2
> 022->labor_income_real_win_
total_income_real_win_2000 total_income_real_win_2002 ... total_income_real_win_2
> 022->total_income_real_win_
ln_lab_inc_final_2000 ln_lab_inc_final_2002 ... ln_lab_inc_final_2022->ln_lab_inc
> _final_
ln_tot_inc_final_2000 ln_tot_inc_final_2002 ... ln_tot_inc_final_2022->ln_tot_inc
> _final_
wealth_core_2000 wealth_core_2002 ... wealth_core_2022->wealth_core_
wealth_ira_2000 wealth_ira_2002 ... wealth_ira_2022->wealth_ira_
wealth_coreira_2000 wealth_coreira_2002 ... wealth_coreira_2022->wealth_coreira_
wealth_total_2000 wealth_total_2002 ... wealth_total_2022->wealth_total_
share_core_2000 share_core_2002 ... share_core_2022->share_core_
share_ira_2000 share_ira_2002 ... share_ira_2022->share_ira_
share_res_2000 share_res_2002 ... share_res_2022->share_res_
share_debt_long_2000 share_debt_long_2002 ... share_debt_long_2022->share_debt_lo
> ng_
share_debt_other_2000 share_debt_other_2002 ... share_debt_other_2022->share_debt
> _other_
wealth_core_d2_2000 wealth_core_d2_2002 ... wealth_core_d2_2022->wealth_core_d2_
wealth_coreira_d2_2000 wealth_coreira_d2_2002 ... wealth_coreira_d2_2022->wealth_
> coreira_d2_
wealth_d2_2000 wealth_d2_2002 ... wealth_d2_2022->wealth_d2_
wealth_core_d3_2000 wealth_core_d3_2002 ... wealth_core_d3_2022->wealth_core_d3_
wealth_coreira_d3_2000 wealth_coreira_d3_2002 ... wealth_coreira_d3_2022->wealth_
> coreira_d3_
wealth_d3_2000 wealth_d3_2002 ... wealth_d3_2022->wealth_d3_
wealth_core_d4_2000 wealth_core_d4_2002 ... wealth_core_d4_2022->wealth_core_d4_
wealth_coreira_d4_2000 wealth_coreira_d4_2002 ... wealth_coreira_d4_2022->wealth_
> coreira_d4_
wealth_d4_2000 wealth_d4_2002 ... wealth_d4_2022->wealth_d4_
wealth_core_d5_2000 wealth_core_d5_2002 ... wealth_core_d5_2022->wealth_core_d5_
wealth_coreira_d5_2000 wealth_coreira_d5_2002 ... wealth_coreira_d5_2022->wealth_
> coreira_d5_
wealth_d5_2000 wealth_d5_2002 ... wealth_d5_2022->wealth_d5_
wealth_core_d6_2000 wealth_core_d6_2002 ... wealth_core_d6_2022->wealth_core_d6_
wealth_coreira_d6_2000 wealth_coreira_d6_2002 ... wealth_coreira_d6_2022->wealth_
> coreira_d6_
wealth_d6_2000 wealth_d6_2002 ... wealth_d6_2022->wealth_d6_
wealth_core_d7_2000 wealth_core_d7_2002 ... wealth_core_d7_2022->wealth_core_d7_
wealth_coreira_d7_2000 wealth_coreira_d7_2002 ... wealth_coreira_d7_2022->wealth_
> coreira_d7_
wealth_d7_2000 wealth_d7_2002 ... wealth_d7_2022->wealth_d7_
wealth_core_d8_2000 wealth_core_d8_2002 ... wealth_core_d8_2022->wealth_core_d8_
wealth_coreira_d8_2000 wealth_coreira_d8_2002 ... wealth_coreira_d8_2022->wealth_
> coreira_d8_
wealth_d8_2000 wealth_d8_2002 ... wealth_d8_2022->wealth_d8_
wealth_core_d9_2000 wealth_core_d9_2002 ... wealth_core_d9_2022->wealth_core_d9_
wealth_coreira_d9_2000 wealth_coreira_d9_2002 ... wealth_coreira_d9_2022->wealth_
> coreira_d9_
wealth_d9_2000 wealth_d9_2002 ... wealth_d9_2022->wealth_d9_
wealth_core_d10_2000 wealth_core_d10_2002 ... wealth_core_d10_2022->wealth_core_d
> 10_
wealth_coreira_d10_2000 wealth_coreira_d10_2002 ... wealth_coreira_d10_2022->weal
> th_coreira_d10_
wealth_d10_2000 wealth_d10_2002 ... wealth_d10_2022->wealth_d10_
         age_2000 age_2002 ... age_2022   ->   age_
age_bin_2000 age_bin_2002 ... age_bin_2022->   age_bin_
married_2000 married_2002 ... married_2022->   married_
inlbrf_2000 inlbrf_2002 ... inlbrf_2022   ->   inlbrf_
censreg_2000 censreg_2002 ... censreg_2022->   censreg_
pop_trust_2000 pop_trust_2002 ... pop_trust_2022->pop_trust_
regional_trust_2000 regional_trust_2002 ... regional_trust_2022->regional_trust_
-----------------------------------------------------------------------------

. 
. * Reshape creates vars from stub: r1_annual_ -> r1_annual_ (trailing underscore
> ). Rename to r1_annual_nw.
. * Avoid Stata ambiguous abbreviation (r1_annual vs r1_annual_win): temp-rename 
> _win first.
. capture confirm variable r1_annual_win

. if !_rc {
.     rename r1_annual_win __r1win
.     rename r4_annual_win __r4win
.     rename r5_annual_win __r5win
. }

. rename r1_annual_ r1_annual_nw

. rename r4_annual_ r4_annual_nw

. rename r5_annual_ r5_annual_nw

. capture confirm variable __r1win

. if !_rc {
.     rename __r1win r1_annual_win
.     rename __r4win r4_annual_win
.     rename __r5win r5_annual_win
. }

. * Share vars for 15 Spec 2: drop trailing underscore
. capture confirm variable share_core_

. if !_rc {
.     rename share_core_ share_core
.     rename share_ira_ share_ira
.     rename share_res_ share_res
. }

. capture confirm variable share_debt_long_

. if !_rc {
.     rename share_debt_long_ share_debt_long
.     rename share_debt_other_ share_debt_other
. }

. * Wealth deciles: drop trailing underscore (wealth_core_d2_ -> wealth_core_d2, 
> etc.)
. forvalues d = 2/10 {
  2.     capture confirm variable wealth_core_d`d'_
  3.     if !_rc rename wealth_core_d`d'_ wealth_core_d`d'
  4.     capture confirm variable wealth_coreira_d`d'_
  5.     if !_rc rename wealth_coreira_d`d'_ wealth_coreira_d`d'
  6.     capture confirm variable wealth_d`d'_
  7.     if !_rc rename wealth_d`d'_ wealth_d`d'
  8. }

. 
. * Post-reshape hard check: raw vars must be r1_annual_nw, r4_annual_nw, r5_annu
> al_nw (required for 14)
. foreach v in r1_annual_nw r4_annual_nw r5_annual_nw {
  2.     capture confirm variable `v'
  3.     if _rc {
  4.         display as error "10_build_panel: `v' missing after reshape. Raw ret
> urns must be present in long panel."
  5.         display as error "  Check that r1_annual_*, r4_annual_*, r5_annual_*
>  were in ret_stubs before reshape."
  6.         log close
  7.         exit 198
  8.     }
  9. }

. display "10_build_panel: raw panel returns present = yes"
10_build_panel: raw panel returns present = yes

. 
. local r1var "r1_annual_nw"

. local r4var "r4_annual_nw"

. local r5var "r5_annual_nw"

. 
. * Weight and time-invariant vars are already attached to each row (they were ke
> pt pre-reshape).
. 
. * ----------------------------------------------------------------------
. * Overlap diagnostics: Ns by year and for key variable sets
. * ----------------------------------------------------------------------
. display "=== Panel structure: observations by year (unbalanced) ==="
=== Panel structure: observations by year (unbalanced) ===

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2000 |     45,234        8.33        8.33
       2002 |     45,234        8.33       16.67
       2004 |     45,234        8.33       25.00
       2006 |     45,234        8.33       33.33
       2008 |     45,234        8.33       41.67
       2010 |     45,234        8.33       50.00
       2012 |     45,234        8.33       58.33
       2014 |     45,234        8.33       66.67
       2016 |     45,234        8.33       75.00
       2018 |     45,234        8.33       83.33
       2020 |     45,234        8.33       91.67
       2022 |     45,234        8.33      100.00
------------+-----------------------------------
      Total |    542,808      100.00

. 
. display "=== Overlap: r1/r4/r5 and basic controls by year ==="
=== Overlap: r1/r4/r5 and basic controls by year ===

. * Use age_bin (not age) to avoid ambiguous abbreviation with age_bin
. foreach y of local years {
  2.     quietly count if year == `y' & !missing(`r1var') & !missing(`r4var') & !
> missing(`r5var')
  3.     display "Year `y': r1 & r4 & r5 nonmissing = " %9.0f r(N)
  4. 
.     quietly count if year == `y' & !missing(`r1var') & !missing(`r4var') & !mis
> sing(`r5var') ///
>         & !missing(labor_income_real_win) & !missing(total_income_real_win) ///
>         & !missing(age_bin) & !missing(married) & !missing(inlbrf)
  5.     display "Year `y': r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmiss
> ing = " %9.0f r(N)
  6. }
Year 2002: r1 & r4 & r5 nonmissing =     11925
Year 2002: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =     11701
Year 2004: r1 & r4 & r5 nonmissing =     11310
Year 2004: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =     11099
Year 2006: r1 & r4 & r5 nonmissing =     12021
Year 2006: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =     11821
Year 2008: r1 & r4 & r5 nonmissing =     11114
Year 2008: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =     10896
Year 2010: r1 & r4 & r5 nonmissing =      9910
Year 2010: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =      9681
Year 2012: r1 & r4 & r5 nonmissing =     11008
Year 2012: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =     10772
Year 2014: r1 & r4 & r5 nonmissing =     10045
Year 2014: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =      9829
Year 2016: r1 & r4 & r5 nonmissing =      8923
Year 2016: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =      8783
Year 2018: r1 & r4 & r5 nonmissing =      8761
Year 2018: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =      8639
Year 2020: r1 & r4 & r5 nonmissing =      7687
Year 2020: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =      7607
Year 2022: r1 & r4 & r5 nonmissing =      6950
Year 2022: r1/r4/r5 + inc (lab+tot) + age/married/inlbrf nonmissing =      6852

. 
. display "=== Overlap: trust (2020) + r1/r4/r5 by year ==="
=== Overlap: trust (2020) + r1/r4/r5 by year ===

. capture confirm variable trust_others_2020

. if !_rc {
.     foreach y of local years {
  2.         quietly count if year == `y' & !missing(`r1var') & !missing(`r4var')
>  & !missing(`r5var') ///
>             & !missing(trust_others_2020)
  3.         display "Year `y': r1/r4/r5 + General trust nonmissing = " %9.0f r(N
> )
  4.     }
Year 2002: r1/r4/r5 + General trust nonmissing =       154
Year 2004: r1/r4/r5 + General trust nonmissing =       159
Year 2006: r1/r4/r5 + General trust nonmissing =       233
Year 2008: r1/r4/r5 + General trust nonmissing =       222
Year 2010: r1/r4/r5 + General trust nonmissing =       222
Year 2012: r1/r4/r5 + General trust nonmissing =       313
Year 2014: r1/r4/r5 + General trust nonmissing =       321
Year 2016: r1/r4/r5 + General trust nonmissing =       329
Year 2018: r1/r4/r5 + General trust nonmissing =       375
Year 2020: r1/r4/r5 + General trust nonmissing =       390
Year 2022: r1/r4/r5 + General trust nonmissing =       354
. }

. else {
.     display "General trust (trust_others_2020) not found; skipping trust overla
> p diagnostics."
. }

. 
. * Optional: overall waves-per-person counts for returns
. display "=== Overlap: number of waves with nonmissing r1 & r4 & r5 per person =
> =="
=== Overlap: number of waves with nonmissing r1 & r4 & r5 per person ===

. preserve

.     gen byte has_r = (!missing(`r1var') & !missing(`r4var') & !missing(`r5var')
> )

.     bysort hhidpn: egen byte n_waves_r = total(has_r)

.     bysort hhidpn: keep if _n == 1
(497,574 observations deleted)

.     tab n_waves_r

  n_waves_r |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     21,334       47.16       47.16
          1 |      4,767       10.54       57.70
          2 |      3,416        7.55       65.25
          3 |      3,150        6.96       72.22
          4 |      2,115        4.68       76.89
          5 |      1,843        4.07       80.97
          6 |      2,155        4.76       85.73
          7 |      1,373        3.04       88.77
          8 |      1,279        2.83       91.59
          9 |      1,389        3.07       94.67
         10 |        887        1.96       96.63
         11 |      1,526        3.37      100.00
------------+-----------------------------------
      Total |     45,234      100.00

. restore

. 
. * ----------------------------------------------------------------------
. * Save long, unbalanced panel dataset for regressions
. * ----------------------------------------------------------------------
. save "${PROCESSED}/analysis_final_long_unbalanced.dta", replace
file /Volumes/SSD
    PRO/Github-forks/Chp2-TrustandReturns/Code/Processing/analysis_final_long_u
    > nbalanced.dta saved

. display "10_build_panel: Saved ${PROCESSED}/analysis_final_long_unbalanced.dta"
10_build_panel: Saved /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Pro
> cessing/analysis_final_long_unbalanced.dta

. 
. log close
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Notes/Logs/10_bui
> ld_panel.log
  log type:  text
 closed on:  20 Feb 2026, 10:11:35
---------------------------------------------------------------------------------
