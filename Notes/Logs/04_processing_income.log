---------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Notes/Logs/04_pro
> cessing_income.log
  log type:  text
 opened on:  17 Feb 2026, 16:11:08

. 
. use "${PROCESSED}/analysis_ready.dta", clear

. 
. * Keep all variables; only modify income series below
. 
. * Require income series to exist
. capture unab _lab_any : labor_income_*

. if _rc {
.     display as error "04: labor_income_* not found in analysis_ready.dta. Run 0
> 2_compute_returns_income.do and 03_prep_controls.do first."
.     log close
.     exit 0
. }

. capture unab _tot_any : total_income_*

. if _rc {
.     display as error "04: total_income_* not found in analysis_ready.dta. Run 0
> 2_compute_returns_income.do and 03_prep_controls.do first."
.     log close
.     exit 0
. }

. 
. * Year list (even years, 2000â€“2022)
. local years "2000 2002 2004 2006 2008 2010 2012 2014 2016 2018 2020 2022"

. 
. * Ensure income stubs exist and build varlists
. local labvars ""

. local totvars ""

. foreach y of local years {
  2.     capture confirm variable labor_income_`y'
  3.     if _rc {
  4.         gen double labor_income_`y' = .
  5.     }
  6.     capture confirm variable total_income_`y'
  7.     if _rc {
  8.         gen double total_income_`y' = .
  9.     }
 10.     local labvars "`labvars' labor_income_`y'"
 11.     local totvars "`totvars' total_income_`y'"
 12. }
(45,234 missing values generated)
(45,234 missing values generated)

. 
. * ---------------------------------------------------------------------
. * Deflate to 2021 dollars using CPI (CPIAUCSL.csv from FRED)
. * ---------------------------------------------------------------------
. display "=== Deflation to 2021 dollars ==="
=== Deflation to 2021 dollars ===

. tempfile cpi

. preserve

. import delimited "${FRED_DATA}/CPIAUCSL.csv", clear
(encoding automatically selected: ISO-8859-1)
(3 vars, 949 obs)

. capture confirm variable date

. if _rc {
.     capture confirm variable DATE
.     if !_rc rename DATE date
. }

. capture confirm variable CPIAUCSL

. if _rc {
.     capture confirm variable cpiaucsl
.     if !_rc rename cpiaucsl CPIAUCSL
. }

. gen year = real(substr(date,1,4))

. collapse (mean) CPIAUCSL, by(year)

. rename CPIAUCSL cpi

. save "`cpi'", replace
(file /var/folders/17/1rg0y2kj74l9p9g301vbhhkw0000gn/T//S_30768.000002 not
    found)
file /var/folders/17/1rg0y2kj74l9p9g301vbhhkw0000gn/T//S_30768.000002 saved as
    .dta format

. 
. quietly summarize cpi if year == 2021

. local cpi_2021 = r(mean)

. foreach y of local years {
  2.     quietly summarize cpi if year == `y'
  3.     local cpi_`y' = r(mean)
  4. }

. restore

. 
. display "Tabstat income before deflation"
Tabstat income before deflation

. tabstat `labvars' `totvars', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  lab~2000  lab~2002  lab~2004  lab~2006  lab~2008  lab~2010  lab~2012
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .  10773.54   14165.7  13128.49  12812.57  17190.45   16536.6
      SD |         .  28083.09   37124.1  57524.24  35307.18   38784.9  39818.89
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .     57000     70000     67000     70000     82000     81000
     p99 |         .    115000    140000  132273.2  140875.1  154418.2    160000
     Min |         .         0         0         0         0         0         0
     Max |         .    757000   2000000   6525000   1425000   1400000   1053000
--------------------------------------------------------------------------------

   Stats |  lab~2014  lab~2016  lab~2018  lab~2020  lab~2022  tot~2000  tot~2002
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  16099.66  20480.91  20128.43  20092.79  21690.91         .  37026.81
      SD |  41015.19  47428.68   59975.8  54200.87  52520.89         .  84838.98
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .      2566
     p50 |         0         0         0         0         0         .     20040
     p95 |     83000    100000     99000    100000    108000         .  115599.5
     p99 |  168731.4  190660.2    195000    195000    225000         .  276652.6
     Min |         0         0         0         0         0         .         0
     Max |   1600000   1400000   3260000   2500000   1200000         .   7395354
--------------------------------------------------------------------------------

   Stats |  tot~2004  tot~2006  tot~2008  tot~2010  tot~2012  tot~2014  tot~2016
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  41800.37  46586.64  48611.16  43426.45  44823.46  47629.47  51788.15
      SD |  86267.02  301749.7  466212.2  86623.62  87167.35  129245.5  145725.5
      p1 |         0         0         0         0         0         0         0
      p5 |      2256      3300      3600       700      1040      1200       192
     p50 |     22000     22800     23612     23554     23526     24450  25971.05
     p95 |    134360  133737.7  145023.4  135302.3    142004    145508  162177.6
     p99 |    310015    336319    349000    303448    330025  355704.5    402260
     Min |         0         0         0         0         0         0         0
     Max |   3536773  2.54e+07  6.00e+07   5438860   3663276  1.09e+07  1.00e+07
--------------------------------------------------------------------------------

   Stats |  tot~2018  tot~2020  tot~2022
---------+------------------------------
       N |     17146     15723     15856
    Mean |  53714.35  53990.98  59025.53
      SD |  135825.1  112273.2  128833.8
      p1 |         0         0         0
      p5 |       100       700       276
     p50 |     26000  27750.42   29142.1
     p95 |    167500    173600    194000
     p99 |    423990  430294.8  457653.2
     Min |         0         0         0
     Max |   7366716   5731600   4702364
----------------------------------------

. 
. local labreal ""

. local totreal ""

. foreach y of local years {
  2.     local cpi_y = `cpi_`y''
  3.     capture drop labor_income_real_`y' total_income_real_`y'
  4.     if "`cpi_y'" != "" {
  5.         gen double labor_income_real_`y' = labor_income_`y' * (`cpi_2021' / 
> `cpi_y')
  6.         gen double total_income_real_`y' = total_income_`y' * (`cpi_2021' / 
> `cpi_y')
  7.     }
  8.     else {
  9.         gen double labor_income_real_`y' = .
 10.         gen double total_income_real_`y' = .
 11.     }
 12.     local labreal "`labreal' labor_income_real_`y'"
 13.     local totreal "`totreal' total_income_real_`y'"
 14. }
(45,234 missing values generated)
(45,234 missing values generated)
(27,069 missing values generated)
(27,069 missing values generated)
(25,105 missing values generated)
(25,105 missing values generated)
(26,765 missing values generated)
(26,765 missing values generated)
(28,017 missing values generated)
(28,017 missing values generated)
(23,200 missing values generated)
(23,200 missing values generated)
(24,680 missing values generated)
(24,680 missing values generated)
(26,487 missing values generated)
(26,487 missing values generated)
(24,322 missing values generated)
(24,322 missing values generated)
(28,088 missing values generated)
(28,088 missing values generated)
(29,511 missing values generated)
(29,511 missing values generated)
(29,378 missing values generated)
(29,378 missing values generated)

. 
. display "Tabstat income after deflation"
Tabstat income after deflation

. tabstat `labreal' `totreal', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  l~l_2000  l~l_2002  l~l_2004  l~l_2006  l~l_2008  l~l_2010  l~l_2012
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .   16230.6  20319.53  17649.83  16129.14  21360.22  19517.65
      SD |         .  42307.84  53251.47  77335.12  44446.54  48192.69  46997.02
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .  85871.86  100409.2  90074.27   88119.7  101890.2  95601.82
     p99 |         .  173250.2  200818.5    177827  177341.1  191874.3  188843.1
     Min |         .         0         0         0         0         0         0
     Max |         .   1140439   2868835   8772158   1793865   1739588   1242824
--------------------------------------------------------------------------------

   Stats |  l~l_2014  l~l_2016  l~l_2018  l~l_2020  l~l_2022  t~l_2000  t~l_2002
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  18429.67  23123.57  21721.55  21033.38  20085.88         .  55781.77
      SD |  46951.09  53548.42  64722.73  56738.14  48634.59         .  127811.9
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .   3865.74
     p50 |         0         0         0         0         0         .  30190.74
     p95 |  95012.12    112903  106835.6  104681.2  100008.5         .  174153.5
     p99 |  193150.9  215261.1  210433.8  204128.4  208351.1         .  416783.7
     Min |         0         0         0         0         0         .         0
     Max |   1831559   1580643   3518021   2617031   1111206         .  1.11e+07
--------------------------------------------------------------------------------

   Stats |  t~l_2004  t~l_2006  t~l_2008  t~l_2010  t~l_2012  t~l_2014  t~l_2016
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  59959.19   62630.7  61194.29  53960.11  52903.75  54522.62   58470.4
      SD |  123742.9  405669.9  586892.5  107635.3    102881  147950.5  164528.6
      p1 |         0         0         0         0         0         0         0
      p5 |  3236.046  4436.494   4531.87  869.7942   1227.48  1373.669  216.7738
     p50 |  31557.19  30652.14  29724.03  29267.33  27767.02  27988.51  29322.11
     p95 |  192728.3  179795.8  182563.1  168121.7    167603  166566.6  183103.5
     p99 |    444691  452144.6  439339.6  377053.3  389518.4  407183.6  454163.8
     Min |         0         0         0         0         0         0         0
     Max |   5073210  3.41e+07  7.55e+07   6758127   4323653  1.25e+07  1.13e+07
--------------------------------------------------------------------------------

   Stats |  t~l_2018  t~l_2020  t~l_2022
---------+------------------------------
       N |     17146     15723     15856
    Mean |  57965.71  56518.43  54657.92
      SD |  146575.3    117529  119300.7
      p1 |         0         0         0
      p5 |  107.9148  732.7687  255.5773
     p50 |  28057.84  29049.48  26985.72
     p95 |  180757.2  181726.6  179644.9
     p99 |  457547.8    450438    423789
     Min |         0         0         0
     Max |   7949774   5999910   4354411
----------------------------------------

. 
. * ---------------------------------------------------------------------
. * Winsorize deflated levels (separate toggle on deflated series)
. * ---------------------------------------------------------------------
. display "=== 1% winsorization on deflated levels ==="
=== 1% winsorization on deflated levels ===

. display "Tabstat deflated income before winsorization"
Tabstat deflated income before winsorization

. tabstat `labreal' `totreal', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  l~l_2000  l~l_2002  l~l_2004  l~l_2006  l~l_2008  l~l_2010  l~l_2012
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .   16230.6  20319.53  17649.83  16129.14  21360.22  19517.65
      SD |         .  42307.84  53251.47  77335.12  44446.54  48192.69  46997.02
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .  85871.86  100409.2  90074.27   88119.7  101890.2  95601.82
     p99 |         .  173250.2  200818.5    177827  177341.1  191874.3  188843.1
     Min |         .         0         0         0         0         0         0
     Max |         .   1140439   2868835   8772158   1793865   1739588   1242824
--------------------------------------------------------------------------------

   Stats |  l~l_2014  l~l_2016  l~l_2018  l~l_2020  l~l_2022  t~l_2000  t~l_2002
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  18429.67  23123.57  21721.55  21033.38  20085.88         .  55781.77
      SD |  46951.09  53548.42  64722.73  56738.14  48634.59         .  127811.9
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .   3865.74
     p50 |         0         0         0         0         0         .  30190.74
     p95 |  95012.12    112903  106835.6  104681.2  100008.5         .  174153.5
     p99 |  193150.9  215261.1  210433.8  204128.4  208351.1         .  416783.7
     Min |         0         0         0         0         0         .         0
     Max |   1831559   1580643   3518021   2617031   1111206         .  1.11e+07
--------------------------------------------------------------------------------

   Stats |  t~l_2004  t~l_2006  t~l_2008  t~l_2010  t~l_2012  t~l_2014  t~l_2016
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  59959.19   62630.7  61194.29  53960.11  52903.75  54522.62   58470.4
      SD |  123742.9  405669.9  586892.5  107635.3    102881  147950.5  164528.6
      p1 |         0         0         0         0         0         0         0
      p5 |  3236.046  4436.494   4531.87  869.7942   1227.48  1373.669  216.7738
     p50 |  31557.19  30652.14  29724.03  29267.33  27767.02  27988.51  29322.11
     p95 |  192728.3  179795.8  182563.1  168121.7    167603  166566.6  183103.5
     p99 |    444691  452144.6  439339.6  377053.3  389518.4  407183.6  454163.8
     Min |         0         0         0         0         0         0         0
     Max |   5073210  3.41e+07  7.55e+07   6758127   4323653  1.25e+07  1.13e+07
--------------------------------------------------------------------------------

   Stats |  t~l_2018  t~l_2020  t~l_2022
---------+------------------------------
       N |     17146     15723     15856
    Mean |  57965.71  56518.43  54657.92
      SD |  146575.3    117529  119300.7
      p1 |         0         0         0
      p5 |  107.9148  732.7687  255.5773
     p50 |  28057.84  29049.48  26985.72
     p95 |  180757.2  181726.6  179644.9
     p99 |  457547.8    450438    423789
     Min |         0         0         0
     Max |   7949774   5999910   4354411
----------------------------------------

. 
. local labrealwin ""

. local totrealwin ""

. foreach y of local years {
  2.     quietly summarize labor_income_real_`y', detail
  3.     local p1_lab = r(p1)
  4.     local p99_lab = r(p99)
  5.     capture drop labor_income_real_win_`y'
  6.     gen double labor_income_real_win_`y' = labor_income_real_`y'
  7.     replace labor_income_real_win_`y' = `p1_lab' if labor_income_real_win_`y
> ' < `p1_lab' & !missing(labor_income_real_win_`y')
  8.     replace labor_income_real_win_`y' = `p99_lab' if labor_income_real_win_`
> y' > `p99_lab' & !missing(labor_income_real_win_`y')
  9. 
.     quietly summarize total_income_real_`y', detail
 10.     local p1_tot = r(p1)
 11.     local p99_tot = r(p99)
 12.     capture drop total_income_real_win_`y'
 13.     gen double total_income_real_win_`y' = total_income_real_`y'
 14.     replace total_income_real_win_`y' = `p1_tot' if total_income_real_win_`y
> ' < `p1_tot' & !missing(total_income_real_win_`y')
 15.     replace total_income_real_win_`y' = `p99_tot' if total_income_real_win_`
> y' > `p99_tot' & !missing(total_income_real_win_`y')
 16. 
.     * Persist deflated + winsorized income and derived transforms
.     capture drop lab_inc_defl_win_`y' tot_inc_defl_win_`y'
 17.     gen double lab_inc_defl_win_`y' = labor_income_real_win_`y'
 18.     gen double tot_inc_defl_win_`y' = total_income_real_win_`y'
 19. 
.     capture drop ln_lab_inc_defl_win_`y' ln_tot_inc_defl_win_`y'
 20.     gen double ln_lab_inc_defl_win_`y' = ln(lab_inc_defl_win_`y') if lab_inc
> _defl_win_`y' > 0
 21.     gen double ln_tot_inc_defl_win_`y' = ln(tot_inc_defl_win_`y') if tot_inc
> _defl_win_`y' > 0
 22. 
.     * Scaled asinh: asinh(x / median_positive_x) for deflated + winsorized leve
> ls
.     quietly summarize lab_inc_defl_win_`y' if lab_inc_defl_win_`y' > 0, detail
 23.     local med_lab_dw = r(p50)
 24.     local N_pos_lab_dw = r(N)
 25.     capture drop ihs_lab_inc_defl_win_s_`y'
 26.     gen double ihs_lab_inc_defl_win_s_`y' = .
 27.     if `N_pos_lab_dw' > 0 & `med_lab_dw' > 0 {
 28.         replace ihs_lab_inc_defl_win_s_`y' = asinh(lab_inc_defl_win_`y' / `m
> ed_lab_dw') if !missing(lab_inc_defl_win_`y')
 29.     }
 30. 
.     quietly summarize tot_inc_defl_win_`y' if tot_inc_defl_win_`y' > 0, detail
 31.     local med_tot_dw = r(p50)
 32.     local N_pos_tot_dw = r(N)
 33.     capture drop ihs_tot_inc_defl_win_s_`y'
 34.     gen double ihs_tot_inc_defl_win_s_`y' = .
 35.     if `N_pos_tot_dw' > 0 & `med_tot_dw' > 0 {
 36.         replace ihs_tot_inc_defl_win_s_`y' = asinh(tot_inc_defl_win_`y' / `m
> ed_tot_dw') if !missing(tot_inc_defl_win_`y')
 37.     }
 38. 
.     local labrealwin "`labrealwin' labor_income_real_win_`y'"
 39.     local totrealwin "`totrealwin' total_income_real_win_`y'"
 40. }
(45,234 missing values generated)
(0 real changes made)
(0 real changes made)
(45,234 missing values generated)
(0 real changes made)
(0 real changes made)
(45,234 missing values generated)
(45,234 missing values generated)
(45,234 missing values generated)
(45,234 missing values generated)
(45,234 missing values generated)
(45,234 missing values generated)
(27,069 missing values generated)
(0 real changes made)
(172 real changes made)
(27,069 missing values generated)
(0 real changes made)
(181 real changes made)
(27,069 missing values generated)
(27,069 missing values generated)
(39,578 missing values generated)
(27,432 missing values generated)
(45,234 missing values generated)
(18,165 real changes made)
(45,234 missing values generated)
(18,165 real changes made)
(25,105 missing values generated)
(0 real changes made)
(189 real changes made)
(25,105 missing values generated)
(0 real changes made)
(201 real changes made)
(25,105 missing values generated)
(25,105 missing values generated)
(37,779 missing values generated)
(25,532 missing values generated)
(45,234 missing values generated)
(20,129 real changes made)
(45,234 missing values generated)
(20,129 real changes made)
(26,765 missing values generated)
(0 real changes made)
(184 real changes made)
(26,765 missing values generated)
(0 real changes made)
(184 real changes made)
(26,765 missing values generated)
(26,765 missing values generated)
(39,112 missing values generated)
(27,089 missing values generated)
(45,234 missing values generated)
(18,469 real changes made)
(45,234 missing values generated)
(18,469 real changes made)
(28,017 missing values generated)
(0 real changes made)
(172 real changes made)
(28,017 missing values generated)
(0 real changes made)
(172 real changes made)
(28,017 missing values generated)
(28,017 missing values generated)
(39,857 missing values generated)
(28,341 missing values generated)
(45,234 missing values generated)
(17,217 real changes made)
(45,234 missing values generated)
(17,217 real changes made)
(23,200 missing values generated)
(0 real changes made)
(220 real changes made)
(23,200 missing values generated)
(0 real changes made)
(221 real changes made)
(23,200 missing values generated)
(23,200 missing values generated)
(36,542 missing values generated)
(23,967 missing values generated)
(45,234 missing values generated)
(22,034 real changes made)
(45,234 missing values generated)
(22,034 real changes made)
(24,680 missing values generated)
(0 real changes made)
(205 real changes made)
(24,680 missing values generated)
(0 real changes made)
(205 real changes made)
(24,680 missing values generated)
(24,680 missing values generated)
(37,660 missing values generated)
(25,362 missing values generated)
(45,234 missing values generated)
(20,554 real changes made)
(45,234 missing values generated)
(20,554 real changes made)
(26,487 missing values generated)
(0 real changes made)
(188 real changes made)
(26,487 missing values generated)
(0 real changes made)
(187 real changes made)
(26,487 missing values generated)
(26,487 missing values generated)
(38,812 missing values generated)
(27,092 missing values generated)
(45,234 missing values generated)
(18,747 real changes made)
(45,234 missing values generated)
(18,747 real changes made)
(24,322 missing values generated)
(0 real changes made)
(209 real changes made)
(24,322 missing values generated)
(0 real changes made)
(209 real changes made)
(24,322 missing values generated)
(24,322 missing values generated)
(37,106 missing values generated)
(25,198 missing values generated)
(45,234 missing values generated)
(20,912 real changes made)
(45,234 missing values generated)
(20,912 real changes made)
(28,088 missing values generated)
(0 real changes made)
(168 real changes made)
(28,088 missing values generated)
(0 real changes made)
(171 real changes made)
(28,088 missing values generated)
(28,088 missing values generated)
(38,920 missing values generated)
(28,847 missing values generated)
(45,234 missing values generated)
(17,146 real changes made)
(45,234 missing values generated)
(17,146 real changes made)
(29,511 missing values generated)
(0 real changes made)
(157 real changes made)
(29,511 missing values generated)
(0 real changes made)
(157 real changes made)
(29,511 missing values generated)
(29,511 missing values generated)
(39,551 missing values generated)
(30,142 missing values generated)
(45,234 missing values generated)
(15,723 real changes made)
(45,234 missing values generated)
(15,723 real changes made)
(29,378 missing values generated)
(0 real changes made)
(154 real changes made)
(29,378 missing values generated)
(0 real changes made)
(159 real changes made)
(29,378 missing values generated)
(29,378 missing values generated)
(39,519 missing values generated)
(30,039 missing values generated)
(45,234 missing values generated)
(15,856 real changes made)
(45,234 missing values generated)
(15,856 real changes made)

. 
. display "Tabstat deflated income after winsorization"
Tabstat deflated income after winsorization

. tabstat `labrealwin' `totrealwin', statistics(n mean sd p1 p5 p50 p95 p99 min m
> ax)

   Stats |  labor_..  labor_..  labor_..  labor_..  labor_..  labor_..  labor_..
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .  15135.96  19002.95     16159  14976.45  20165.05  18250.02
      SD |         .  32581.56  37651.11  33698.05  32820.76  37832.26  36190.71
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .  85871.86  100409.2  90074.27   88119.7  101890.2  95601.82
     p99 |         .  173250.2  200818.5    177827  177341.1  191874.3  188843.1
     Min |         .         0         0         0         0         0         0
     Max |         .  173250.2  200818.5    177827  177341.1  191874.3  188843.1
--------------------------------------------------------------------------------

   Stats |  labor_..  labor_..  labor_..  labor_..  labor_..  total_..  total_..
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  17278.48  21644.23  19847.59     19568  18859.99         .  51879.56
      SD |  36130.46  41289.47  39573.98  39173.98  38345.78         .  66408.64
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .   3865.74
     p50 |         0         0         0         0         0         .  30190.74
     p95 |  95012.12    112903  106835.6  104681.2  100008.5         .  174153.5
     p99 |  193150.9  215261.1  210433.8  204128.4  208351.1         .  416783.7
     Min |         0         0         0         0         0         .         0
     Max |  193150.9  215261.1  210433.8  204128.4  208351.1         .  416783.7
--------------------------------------------------------------------------------

   Stats |  total_..  total_..  total_..  total_..  total_..  total_..  total_..
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  55398.98  53490.91   52959.1  50370.51  49179.34  49728.29  53540.13
      SD |  71843.25  70023.78  69116.71  62363.52  63013.48  63835.67  71989.35
      p1 |         0         0         0         0         0         0         0
      p5 |  3236.046  4436.494   4531.87  869.7942   1227.48  1373.669  216.7738
     p50 |  31557.19  30652.14  29724.03  29267.33  27767.02  27988.51  29322.11
     p95 |  192728.3  179795.8  182563.1  168121.7    167603  166566.6  183103.5
     p99 |    444691  452144.6  439339.6  377053.3  389518.4  407183.6  454163.8
     Min |         0         0         0         0         0         0         0
     Max |    444691  452144.6  439339.6  377053.3  389518.4  407183.6  454163.8
--------------------------------------------------------------------------------

   Stats |  total_..  total_..  total_..
---------+------------------------------
       N |     17146     15723     15856
    Mean |  52320.76   52702.8  50625.02
      SD |  71356.05  70308.87  68372.63
      p1 |         0         0         0
      p5 |  107.9148  732.7687  255.5773
     p50 |  28057.84  29049.48  26985.72
     p95 |  180757.2  181726.6  179644.9
     p99 |  457547.8    450438    423789
     Min |         0         0         0
     Max |  457547.8    450438    423789
----------------------------------------

. 
. * ---------------------------------------------------------------------
. * Log income (separate toggle on original series)
. * ---------------------------------------------------------------------
. display "=== Log income (original series) ==="
=== Log income (original series) ===

. display "Tabstat income before logs"
Tabstat income before logs

. tabstat `labvars' `totvars', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  l~e_2000  l~e_2002  l~e_2004  l~e_2006  l~e_2008  l~e_2010  l~e_2012
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .  10773.54   14165.7  13128.49  12812.57  17190.45   16536.6
      SD |         .  28083.09   37124.1  57524.24  35307.18   38784.9  39818.89
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .     57000     70000     67000     70000     82000     81000
     p99 |         .    115000    140000  132273.2  140875.1  154418.2    160000
     Min |         .         0         0         0         0         0         0
     Max |         .    757000   2000000   6525000   1425000   1400000   1053000
--------------------------------------------------------------------------------

   Stats |  l~e_2014  l~e_2016  l~e_2018  l~e_2020  l~e_2022  t~e_2000  t~e_2002
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  16099.66  20480.91  20128.43  20092.79  21690.91         .  37026.81
      SD |  41015.19  47428.68   59975.8  54200.87  52520.89         .  84838.98
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .      2566
     p50 |         0         0         0         0         0         .     20040
     p95 |     83000    100000     99000    100000    108000         .  115599.5
     p99 |  168731.4  190660.2    195000    195000    225000         .  276652.6
     Min |         0         0         0         0         0         .         0
     Max |   1600000   1400000   3260000   2500000   1200000         .   7395354
--------------------------------------------------------------------------------

   Stats |  t~e_2004  t~e_2006  t~e_2008  t~e_2010  t~e_2012  t~e_2014  t~e_2016
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  41800.37  46586.64  48611.16  43426.45  44823.46  47629.47  51788.15
      SD |  86267.02  301749.7  466212.2  86623.62  87167.35  129245.5  145725.5
      p1 |         0         0         0         0         0         0         0
      p5 |      2256      3300      3600       700      1040      1200       192
     p50 |     22000     22800     23612     23554     23526     24450  25971.05
     p95 |    134360  133737.7  145023.4  135302.3    142004    145508  162177.6
     p99 |    310015    336319    349000    303448    330025  355704.5    402260
     Min |         0         0         0         0         0         0         0
     Max |   3536773  2.54e+07  6.00e+07   5438860   3663276  1.09e+07  1.00e+07
--------------------------------------------------------------------------------

   Stats |  t~e_2018  total_..  t~e_2022
---------+------------------------------
       N |     17146     15723     15856
    Mean |  53714.35  53990.98  59025.53
      SD |  135825.1  112273.2  128833.8
      p1 |         0         0         0
      p5 |       100       700       276
     p50 |     26000  27750.42   29142.1
     p95 |    167500    173600    194000
     p99 |    423990  430294.8  457653.2
     Min |         0         0         0
     Max |   7366716   5731600   4702364
----------------------------------------

. 
. local lablog ""

. local totlog ""

. foreach y of local years {
  2.     capture drop ln_lab_inc_`y' ln_tot_inc_`y'
  3.     gen double ln_lab_inc_`y' = ln(labor_income_`y') if labor_income_`y' > 0
  4.     gen double ln_tot_inc_`y' = ln(total_income_`y') if total_income_`y' > 0
  5.     local lablog "`lablog' ln_lab_inc_`y'"
  6.     local totlog "`totlog' ln_tot_inc_`y'"
  7. }
(45,234 missing values generated)
(45,234 missing values generated)
(39,578 missing values generated)
(27,432 missing values generated)
(37,779 missing values generated)
(25,532 missing values generated)
(39,112 missing values generated)
(27,089 missing values generated)
(39,857 missing values generated)
(28,341 missing values generated)
(36,542 missing values generated)
(23,967 missing values generated)
(37,660 missing values generated)
(25,362 missing values generated)
(38,812 missing values generated)
(27,092 missing values generated)
(37,106 missing values generated)
(25,198 missing values generated)
(38,920 missing values generated)
(28,847 missing values generated)
(39,551 missing values generated)
(30,142 missing values generated)
(39,519 missing values generated)
(30,039 missing values generated)

. 
. display "Tabstat log income after logs"
Tabstat log income after logs

. tabstat `lablog' `totlog', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..
---------+----------------------------------------------------------------------
       N |         0      5656      7455      6122      5377      8692      7574
    Mean |         .  9.886746  9.962517  10.00025  10.01752  10.11673  10.12727
      SD |         .  1.278154  1.289539  1.243734  1.305799  1.261875  1.273703
      p1 |         .  5.703782  5.521461  6.052089  5.924256  5.991465  5.991465
      p5 |         .  7.600902  7.600902  7.600902  7.600902  7.600902  7.600902
     p50 |         .  10.12663  10.17732  10.22194  10.23996  10.34174  10.30895
     p95 |         .  11.49272  11.58989  11.58058  11.67844  11.70355  11.77529
     p99 |         .  12.12811  12.20607  12.20607  12.28303  12.30138  12.42922
     Min |         .  1.609438  1.791759  3.433987         0  2.995732  2.995732
     Max |         .  13.53712  14.50866  15.69115  14.16968  14.15198  13.86715
--------------------------------------------------------------------------------

   Stats |  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_tot..  ln_tot..
---------+----------------------------------------------------------------------
       N |      6422      8128      6314      5683      5715         0     17802
    Mean |  10.15028  10.29516  10.28425  10.30675  10.37011         .  9.909088
      SD |  1.313855  1.291232  1.327086    1.3485  1.380742         .  1.182881
      p1 |  5.991465  5.991465  5.762051  5.910797  5.703782         .  5.991465
      p5 |  7.600902  7.696213  7.600902  7.600902  7.600902         .   8.34284
     p50 |  10.37349  10.51867  10.51867  10.59663  10.64542         .  9.927228
     p95 |  11.82041  11.91839  11.93164  11.98293  12.05525         .  11.66822
     p99 |  12.42922  12.61154  12.58908    12.544  12.70685         .  12.53637
     Min |   2.70805  2.302585         0  2.197225  2.772589         .         0
     Max |  14.28551  14.15198  14.99724   14.7318  13.99783         .  15.81636
--------------------------------------------------------------------------------

   Stats |  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..
---------+----------------------------------------------------------------------
       N |     19702     18145     16893     21267     19872     18142     20036
    Mean |    9.9914   10.0362  10.09974  10.07582  10.09054   10.1366  10.18113
      SD |  1.247326  1.201174  1.175945  1.252513  1.229532  1.240228  1.325237
      p1 |   5.63479  6.082219   6.44572  5.733341  5.991465  5.981414  5.620401
      p5 |  8.337109  8.476371  8.548692   8.29405   8.30499  8.455318  8.273081
     p50 |  10.02924  10.05449  10.09278  10.12548  10.11261  10.14201  10.23038
     p95 |  11.81377  11.80932  11.89764  11.84151  11.88034   11.9072  12.02934
     p99 |  12.66931   12.7308  12.76632  12.65172  12.71926  12.79468  12.93663
     Min |         0         0         0         0         0 -1.832581 -2.120264
     Max |  15.07873  17.04869  17.91009  15.50908  15.11387  16.20778  16.12169
--------------------------------------------------------------------------------

   Stats |  ln_tot..  ln_tot..  ln_tot..
---------+------------------------------
       N |     16387     15092     15195
    Mean |  10.20303  10.27584  10.33174
      SD |  1.311782  1.228546  1.276795
      p1 |  5.703782   6.49224  5.891644
      p5 |  8.318742  8.525161  8.517193
     p50 |  10.23287   10.2974  10.33202
     p95 |  12.05525  12.08616  12.20408
     p99 |  12.96924  12.99237  13.06393
     Min |         0         0         0
     Max |  15.81248  15.56151  15.36358
----------------------------------------

. 
. * ---------------------------------------------------------------------
. * Trim top/bottom 1% on levels (separate toggle on original series)
. * ---------------------------------------------------------------------
. display "=== 1% trimming on levels (original series) ==="
=== 1% trimming on levels (original series) ===

. display "Tabstat income before trimming"
Tabstat income before trimming

. tabstat `labvars' `totvars', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  l~e_2000  l~e_2002  l~e_2004  l~e_2006  l~e_2008  l~e_2010  l~e_2012
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .  10773.54   14165.7  13128.49  12812.57  17190.45   16536.6
      SD |         .  28083.09   37124.1  57524.24  35307.18   38784.9  39818.89
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .     57000     70000     67000     70000     82000     81000
     p99 |         .    115000    140000  132273.2  140875.1  154418.2    160000
     Min |         .         0         0         0         0         0         0
     Max |         .    757000   2000000   6525000   1425000   1400000   1053000
--------------------------------------------------------------------------------

   Stats |  l~e_2014  l~e_2016  l~e_2018  l~e_2020  l~e_2022  t~e_2000  t~e_2002
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  16099.66  20480.91  20128.43  20092.79  21690.91         .  37026.81
      SD |  41015.19  47428.68   59975.8  54200.87  52520.89         .  84838.98
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .      2566
     p50 |         0         0         0         0         0         .     20040
     p95 |     83000    100000     99000    100000    108000         .  115599.5
     p99 |  168731.4  190660.2    195000    195000    225000         .  276652.6
     Min |         0         0         0         0         0         .         0
     Max |   1600000   1400000   3260000   2500000   1200000         .   7395354
--------------------------------------------------------------------------------

   Stats |  t~e_2004  t~e_2006  t~e_2008  t~e_2010  t~e_2012  t~e_2014  t~e_2016
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  41800.37  46586.64  48611.16  43426.45  44823.46  47629.47  51788.15
      SD |  86267.02  301749.7  466212.2  86623.62  87167.35  129245.5  145725.5
      p1 |         0         0         0         0         0         0         0
      p5 |      2256      3300      3600       700      1040      1200       192
     p50 |     22000     22800     23612     23554     23526     24450  25971.05
     p95 |    134360  133737.7  145023.4  135302.3    142004    145508  162177.6
     p99 |    310015    336319    349000    303448    330025  355704.5    402260
     Min |         0         0         0         0         0         0         0
     Max |   3536773  2.54e+07  6.00e+07   5438860   3663276  1.09e+07  1.00e+07
--------------------------------------------------------------------------------

   Stats |  t~e_2018  total_..  t~e_2022
---------+------------------------------
       N |     17146     15723     15856
    Mean |  53714.35  53990.98  59025.53
      SD |  135825.1  112273.2  128833.8
      p1 |         0         0         0
      p5 |       100       700       276
     p50 |     26000  27750.42   29142.1
     p95 |    167500    173600    194000
     p99 |    423990  430294.8  457653.2
     Min |         0         0         0
     Max |   7366716   5731600   4702364
----------------------------------------

. 
. local labtrim ""

. local tottrim ""

. foreach y of local years {
  2.     quietly summarize labor_income_`y', detail
  3.     local p1_lab = r(p1)
  4.     local p99_lab = r(p99)
  5.     capture drop labor_income_trim_`y'
  6.     gen double labor_income_trim_`y' = labor_income_`y'
  7.     replace labor_income_trim_`y' = . if labor_income_trim_`y' < `p1_lab' | 
> labor_income_trim_`y' > `p99_lab'
  8. 
.     quietly summarize total_income_`y', detail
  9.     local p1_tot = r(p1)
 10.     local p99_tot = r(p99)
 11.     capture drop total_income_trim_`y'
 12.     gen double total_income_trim_`y' = total_income_`y'
 13.     replace total_income_trim_`y' = . if total_income_trim_`y' < `p1_tot' | 
> total_income_trim_`y' > `p99_tot'
 14. 
.     local labtrim "`labtrim' labor_income_trim_`y'"
 15.     local tottrim "`tottrim' total_income_trim_`y'"
 16. }
(45,234 missing values generated)
(0 real changes made)
(45,234 missing values generated)
(0 real changes made)
(27,069 missing values generated)
(172 real changes made, 172 to missing)
(27,069 missing values generated)
(181 real changes made, 181 to missing)
(25,105 missing values generated)
(189 real changes made, 189 to missing)
(25,105 missing values generated)
(201 real changes made, 201 to missing)
(26,765 missing values generated)
(185 real changes made, 185 to missing)
(26,765 missing values generated)
(184 real changes made, 184 to missing)
(28,017 missing values generated)
(173 real changes made, 173 to missing)
(28,017 missing values generated)
(172 real changes made, 172 to missing)
(23,200 missing values generated)
(220 real changes made, 220 to missing)
(23,200 missing values generated)
(220 real changes made, 220 to missing)
(24,680 missing values generated)
(205 real changes made, 205 to missing)
(24,680 missing values generated)
(205 real changes made, 205 to missing)
(26,487 missing values generated)
(187 real changes made, 187 to missing)
(26,487 missing values generated)
(187 real changes made, 187 to missing)
(24,322 missing values generated)
(209 real changes made, 209 to missing)
(24,322 missing values generated)
(209 real changes made, 209 to missing)
(28,088 missing values generated)
(168 real changes made, 168 to missing)
(28,088 missing values generated)
(171 real changes made, 171 to missing)
(29,511 missing values generated)
(157 real changes made, 157 to missing)
(29,511 missing values generated)
(157 real changes made, 157 to missing)
(29,378 missing values generated)
(154 real changes made, 154 to missing)
(29,378 missing values generated)
(158 real changes made, 158 to missing)

. 
. display "Tabstat income after trimming"
Tabstat income after trimming

. tabstat `labtrim' `tottrim', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  l~m_2000  l~m_2002  l~m_2004  l~m_2006  l~m_2008  l~m_2010  l~m_2012
---------+----------------------------------------------------------------------
       N |         0     17993     19940     18284     17044     21814     20349
    Mean |         .  9043.668  12046.44  10802.81  10587.75  14834.91  14006.49
      SD |         .  19128.21  23276.05   22064.4  22717.19  27236.43   27149.7
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .     52000     63000     60000     62000     75000     75000
     p99 |         .     89000    106000    100000    106000    120000    125000
     Min |         .         0         0         0         0         0         0
     Max |         .    115000    140000    132000    140000  154418.2    160000
--------------------------------------------------------------------------------

   Stats |  l~m_2014  l~m_2016  l~m_2018  l~m_2020  l~m_2022  t~m_2000  t~m_2002
---------+----------------------------------------------------------------------
       N |     18560     20703     16978     15566     15702         0     17984
    Mean |  13546.04  17439.42  16644.35  16914.68  18360.08         .  31998.82
      SD |  27676.71   32419.5  32348.13  33133.71  36288.48         .  36962.42
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .      2500
     p50 |         0         0         0         0         0         .     19822
     p95 |     75000     90000     89000     92000    100000         .  104904.3
     p99 |    129000  149977.9    150000    150000  166016.7         .  195815.4
     Min |         0         0         0         0         0         .         0
     Max |  168731.4  190660.2    195000    195000    225000         .  276652.6
--------------------------------------------------------------------------------

   Stats |  t~m_2004  t~m_2006  t~m_2008  t~m_2010  t~m_2012  t~m_2014  t~m_2016
---------+----------------------------------------------------------------------
       N |     19928     18285     17045     21814     20349     18560     20703
    Mean |  35883.88  36804.22  38972.12  37886.07  38762.93  40295.09  43839.18
      SD |  42230.41  42970.31  45657.93  42897.65  45088.36  46353.96  53128.81
      p1 |         0         0         0         0         0         0         0
      p5 |      2200      3230      3600       630      1000      1134       160
     p50 |  21715.03  22435.97     23220     23160  23087.28  24050.41     25456
     p95 |  120099.4  119973.9    129580  123735.7    129992    131198  148361.7
     p99 |  220317.9    224800    237200    220500  233091.7    231600    273600
     Min |         0         0         0         0         0         0         0
     Max |    310015    336319    349000    303448    330025  355704.5    402260
--------------------------------------------------------------------------------

   Stats |  t~m_2018  t~m_2020  t~m_2022
---------+------------------------------
       N |     16975     15566     15698
    Mean |   44700.7  46513.79  50614.36
      SD |  54602.35  55549.83  62093.43
      p1 |         0         0         0
      p5 |        90       600       240
     p50 |     25540   27432.7     28800
     p95 |    152320    157000    174040
     p99 |    281000    288732  322031.1
     Min |         0         0         0
     Max |    423990  430294.8  457653.2
----------------------------------------

. 
. * ---------------------------------------------------------------------
. * Winsorize top/bottom 1% on levels (separate toggle on original series)
. * ---------------------------------------------------------------------
. display "=== 1% winsorization on levels (original series) ==="
=== 1% winsorization on levels (original series) ===

. display "Tabstat income before winsorization"
Tabstat income before winsorization

. tabstat `labvars' `totvars', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  l~e_2000  l~e_2002  l~e_2004  l~e_2006  l~e_2008  l~e_2010  l~e_2012
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .  10773.54   14165.7  13128.49  12812.57  17190.45   16536.6
      SD |         .  28083.09   37124.1  57524.24  35307.18   38784.9  39818.89
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .     57000     70000     67000     70000     82000     81000
     p99 |         .    115000    140000  132273.2  140875.1  154418.2    160000
     Min |         .         0         0         0         0         0         0
     Max |         .    757000   2000000   6525000   1425000   1400000   1053000
--------------------------------------------------------------------------------

   Stats |  l~e_2014  l~e_2016  l~e_2018  l~e_2020  l~e_2022  t~e_2000  t~e_2002
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  16099.66  20480.91  20128.43  20092.79  21690.91         .  37026.81
      SD |  41015.19  47428.68   59975.8  54200.87  52520.89         .  84838.98
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .      2566
     p50 |         0         0         0         0         0         .     20040
     p95 |     83000    100000     99000    100000    108000         .  115599.5
     p99 |  168731.4  190660.2    195000    195000    225000         .  276652.6
     Min |         0         0         0         0         0         .         0
     Max |   1600000   1400000   3260000   2500000   1200000         .   7395354
--------------------------------------------------------------------------------

   Stats |  t~e_2004  t~e_2006  t~e_2008  t~e_2010  t~e_2012  t~e_2014  t~e_2016
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  41800.37  46586.64  48611.16  43426.45  44823.46  47629.47  51788.15
      SD |  86267.02  301749.7  466212.2  86623.62  87167.35  129245.5  145725.5
      p1 |         0         0         0         0         0         0         0
      p5 |      2256      3300      3600       700      1040      1200       192
     p50 |     22000     22800     23612     23554     23526     24450  25971.05
     p95 |    134360  133737.7  145023.4  135302.3    142004    145508  162177.6
     p99 |    310015    336319    349000    303448    330025  355704.5    402260
     Min |         0         0         0         0         0         0         0
     Max |   3536773  2.54e+07  6.00e+07   5438860   3663276  1.09e+07  1.00e+07
--------------------------------------------------------------------------------

   Stats |  t~e_2018  total_..  t~e_2022
---------+------------------------------
       N |     17146     15723     15856
    Mean |  53714.35  53990.98  59025.53
      SD |  135825.1  112273.2  128833.8
      p1 |         0         0         0
      p5 |       100       700       276
     p50 |     26000  27750.42   29142.1
     p95 |    167500    173600    194000
     p99 |    423990  430294.8  457653.2
     Min |         0         0         0
     Max |   7366716   5731600   4702364
----------------------------------------

. 
. local labwin ""

. local totwin ""

. foreach y of local years {
  2.     quietly summarize labor_income_`y', detail
  3.     local p1_lab = r(p1)
  4.     local p99_lab = r(p99)
  5.     capture drop labor_income_win_`y'
  6.     gen double labor_income_win_`y' = labor_income_`y'
  7.     replace labor_income_win_`y' = `p1_lab' if labor_income_win_`y' < `p1_la
> b' & !missing(labor_income_win_`y')
  8.     replace labor_income_win_`y' = `p99_lab' if labor_income_win_`y' > `p99_
> lab' & !missing(labor_income_win_`y')
  9. 
.     quietly summarize total_income_`y', detail
 10.     local p1_tot = r(p1)
 11.     local p99_tot = r(p99)
 12.     capture drop total_income_win_`y'
 13.     gen double total_income_win_`y' = total_income_`y'
 14.     replace total_income_win_`y' = `p1_tot' if total_income_win_`y' < `p1_to
> t' & !missing(total_income_win_`y')
 15.     replace total_income_win_`y' = `p99_tot' if total_income_win_`y' > `p99_
> tot' & !missing(total_income_win_`y')
 16. 
.     local labwin "`labwin' labor_income_win_`y'"
 17.     local totwin "`totwin' total_income_win_`y'"
 18. }
(45,234 missing values generated)
(0 real changes made)
(0 real changes made)
(45,234 missing values generated)
(0 real changes made)
(0 real changes made)
(27,069 missing values generated)
(0 real changes made)
(172 real changes made)
(27,069 missing values generated)
(0 real changes made)
(181 real changes made)
(25,105 missing values generated)
(0 real changes made)
(189 real changes made)
(25,105 missing values generated)
(0 real changes made)
(201 real changes made)
(26,765 missing values generated)
(0 real changes made)
(185 real changes made)
(26,765 missing values generated)
(0 real changes made)
(184 real changes made)
(28,017 missing values generated)
(0 real changes made)
(173 real changes made)
(28,017 missing values generated)
(0 real changes made)
(172 real changes made)
(23,200 missing values generated)
(0 real changes made)
(220 real changes made)
(23,200 missing values generated)
(0 real changes made)
(220 real changes made)
(24,680 missing values generated)
(0 real changes made)
(205 real changes made)
(24,680 missing values generated)
(0 real changes made)
(205 real changes made)
(26,487 missing values generated)
(0 real changes made)
(187 real changes made)
(26,487 missing values generated)
(0 real changes made)
(187 real changes made)
(24,322 missing values generated)
(0 real changes made)
(209 real changes made)
(24,322 missing values generated)
(0 real changes made)
(209 real changes made)
(28,088 missing values generated)
(0 real changes made)
(168 real changes made)
(28,088 missing values generated)
(0 real changes made)
(171 real changes made)
(29,511 missing values generated)
(0 real changes made)
(157 real changes made)
(29,511 missing values generated)
(0 real changes made)
(157 real changes made)
(29,378 missing values generated)
(0 real changes made)
(154 real changes made)
(29,378 missing values generated)
(0 real changes made)
(158 real changes made)

. 
. display "Tabstat income after winsorization"
Tabstat income after winsorization

. tabstat `labwin' `totwin', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  labor_..  labor_..  labor_..  labor_..  labor_..  labor_..  labor_..
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .  10046.94  13247.85  12019.56   11896.9  16228.59  15462.59
      SD |         .  21626.98  26248.36  25065.65  26071.96  30446.95  30663.09
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .     57000     70000     67000     70000     82000     81000
     p99 |         .    115000    140000  132273.2  140875.1  154418.2    160000
     Min |         .         0         0         0         0         0         0
     Max |         .    115000    140000  132273.2  140875.1  154418.2    160000
--------------------------------------------------------------------------------

   Stats |  labor_..  labor_..  labor_..  labor_..  labor_..  total_..  total_..
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  15094.01  19170.63  18391.92  18692.93  20367.06         .   34436.6
      SD |  31562.58  36570.74  36671.52  37422.15  41409.92         .  44080.71
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .      2566
     p50 |         0         0         0         0         0         .     20040
     p95 |     83000    100000     99000    100000    108000         .  115599.5
     p99 |  168731.4  190660.2    195000    195000    225000         .  276652.6
     Min |         0         0         0         0         0         .         0
     Max |  168731.4  190660.2    195000    195000    225000         .  276652.6
--------------------------------------------------------------------------------

   Stats |  total_..  total_..  total_..  total_..  total_..  total_..  total_..
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  38621.24  39788.18  42069.33  40537.59   41667.9  43441.28  47421.33
      SD |  50085.31  52085.84  54904.52  50189.42  53389.06   55765.1   63762.1
      p1 |         0         0         0         0         0         0         0
      p5 |      2256      3300      3600       700      1040      1200       192
     p50 |     22000     22800     23612     23554     23526     24450  25971.05
     p95 |    134360  133737.7  145023.4  135302.3    142004    145508  162177.6
     p99 |    310015    336319    349000    303448    330025  355704.5    402260
     Min |         0         0         0         0         0         0         0
     Max |    310015    336319    349000    303448    330025  355704.5    402260
--------------------------------------------------------------------------------

   Stats |  total_..  total_..  total_..
---------+------------------------------
       N |     17146     15723     15856
    Mean |  48483.41  50345.98  54670.37
      SD |   66122.6  67164.72  73836.16
      p1 |         0         0         0
      p5 |       100       700       276
     p50 |     26000  27750.42   29142.1
     p95 |    167500    173600    194000
     p99 |    423990  430294.8  457653.2
     Min |         0         0         0
     Max |    423990  430294.8  457653.2
----------------------------------------

. 
. * ---------------------------------------------------------------------
. * Final toggle (apply all: deflate -> log -> winsorize)
. * ---------------------------------------------------------------------
. display "=== Final toggle: deflate->log->winsorize ==="
=== Final toggle: deflate->log->winsorize ===

. display "Tabstat income before final toggle (original series)"
Tabstat income before final toggle (original series)

. tabstat `labvars' `totvars', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  l~e_2000  l~e_2002  l~e_2004  l~e_2006  l~e_2008  l~e_2010  l~e_2012
---------+----------------------------------------------------------------------
       N |         0     18165     20129     18469     17217     22034     20554
    Mean |         .  10773.54   14165.7  13128.49  12812.57  17190.45   16536.6
      SD |         .  28083.09   37124.1  57524.24  35307.18   38784.9  39818.89
      p1 |         .         0         0         0         0         0         0
      p5 |         .         0         0         0         0         0         0
     p50 |         .         0         0         0         0         0         0
     p95 |         .     57000     70000     67000     70000     82000     81000
     p99 |         .    115000    140000  132273.2  140875.1  154418.2    160000
     Min |         .         0         0         0         0         0         0
     Max |         .    757000   2000000   6525000   1425000   1400000   1053000
--------------------------------------------------------------------------------

   Stats |  l~e_2014  l~e_2016  l~e_2018  l~e_2020  l~e_2022  t~e_2000  t~e_2002
---------+----------------------------------------------------------------------
       N |     18747     20912     17146     15723     15856         0     18165
    Mean |  16099.66  20480.91  20128.43  20092.79  21690.91         .  37026.81
      SD |  41015.19  47428.68   59975.8  54200.87  52520.89         .  84838.98
      p1 |         0         0         0         0         0         .         0
      p5 |         0         0         0         0         0         .      2566
     p50 |         0         0         0         0         0         .     20040
     p95 |     83000    100000     99000    100000    108000         .  115599.5
     p99 |  168731.4  190660.2    195000    195000    225000         .  276652.6
     Min |         0         0         0         0         0         .         0
     Max |   1600000   1400000   3260000   2500000   1200000         .   7395354
--------------------------------------------------------------------------------

   Stats |  t~e_2004  t~e_2006  t~e_2008  t~e_2010  t~e_2012  t~e_2014  t~e_2016
---------+----------------------------------------------------------------------
       N |     20129     18469     17217     22034     20554     18747     20912
    Mean |  41800.37  46586.64  48611.16  43426.45  44823.46  47629.47  51788.15
      SD |  86267.02  301749.7  466212.2  86623.62  87167.35  129245.5  145725.5
      p1 |         0         0         0         0         0         0         0
      p5 |      2256      3300      3600       700      1040      1200       192
     p50 |     22000     22800     23612     23554     23526     24450  25971.05
     p95 |    134360  133737.7  145023.4  135302.3    142004    145508  162177.6
     p99 |    310015    336319    349000    303448    330025  355704.5    402260
     Min |         0         0         0         0         0         0         0
     Max |   3536773  2.54e+07  6.00e+07   5438860   3663276  1.09e+07  1.00e+07
--------------------------------------------------------------------------------

   Stats |  t~e_2018  total_..  t~e_2022
---------+------------------------------
       N |     17146     15723     15856
    Mean |  53714.35  53990.98  59025.53
      SD |  135825.1  112273.2  128833.8
      p1 |         0         0         0
      p5 |       100       700       276
     p50 |     26000  27750.42   29142.1
     p95 |    167500    173600    194000
     p99 |    423990  430294.8  457653.2
     Min |         0         0         0
     Max |   7366716   5731600   4702364
----------------------------------------

. 
. local labfinal ""

. local totfinal ""

. foreach y of local years {
  2.     * Start from deflated series
.     capture confirm variable labor_income_real_`y'
  3.     if _rc {
  4.         gen double labor_income_real_`y' = labor_income_`y' * (`cpi_2021' / 
> `cpi_`y'')
  5.     }
  6.     capture confirm variable total_income_real_`y'
  7.     if _rc {
  8.         gen double total_income_real_`y' = total_income_`y' * (`cpi_2021' / 
> `cpi_`y'')
  9.     }
 10. 
.     * Log: use ln(x) for x > 0; zero income set to missing (dropped from log-in
> come sample, N reflects this)
.     capture drop ln_lab_inc_final_`y' ln_tot_inc_final_`y'
 11.     gen double ln_lab_inc_final_`y' = ln(labor_income_real_`y') if labor_inc
> ome_real_`y' > 0
 12.     gen double ln_tot_inc_final_`y' = ln(total_income_real_`y') if total_inc
> ome_real_`y' > 0
 13. 
.     * Winsorize on log values (p1/p99)
.     quietly summarize ln_lab_inc_final_`y', detail
 14.     local p1_lab = r(p1)
 15.     local p99_lab = r(p99)
 16.     replace ln_lab_inc_final_`y' = `p1_lab' if ln_lab_inc_final_`y' < `p1_la
> b' & !missing(ln_lab_inc_final_`y')
 17.     replace ln_lab_inc_final_`y' = `p99_lab' if ln_lab_inc_final_`y' > `p99_
> lab' & !missing(ln_lab_inc_final_`y')
 18. 
.     quietly summarize ln_tot_inc_final_`y', detail
 19.     local p1_tot = r(p1)
 20.     local p99_tot = r(p99)
 21.     replace ln_tot_inc_final_`y' = `p1_tot' if ln_tot_inc_final_`y' < `p1_to
> t' & !missing(ln_tot_inc_final_`y')
 22.     replace ln_tot_inc_final_`y' = `p99_tot' if ln_tot_inc_final_`y' > `p99_
> tot' & !missing(ln_tot_inc_final_`y')
 23. 
.     local labfinal "`labfinal' ln_lab_inc_final_`y'"
 24.     local totfinal "`totfinal' ln_tot_inc_final_`y'"
 25. }
(45,234 missing values generated)
(45,234 missing values generated)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(39,578 missing values generated)
(27,432 missing values generated)
(49 real changes made)
(55 real changes made)
(175 real changes made)
(179 real changes made)
(37,779 missing values generated)
(25,532 missing values generated)
(70 real changes made)
(65 real changes made)
(197 real changes made)
(198 real changes made)
(39,112 missing values generated)
(27,089 missing values generated)
(61 real changes made)
(57 real changes made)
(181 real changes made)
(181 real changes made)
(39,857 missing values generated)
(28,341 missing values generated)
(53 real changes made)
(54 real changes made)
(168 real changes made)
(168 real changes made)
(36,542 missing values generated)
(23,967 missing values generated)
(85 real changes made)
(90 real changes made)
(212 real changes made)
(213 real changes made)
(37,660 missing values generated)
(25,362 missing values generated)
(70 real changes made)
(70 real changes made)
(192 real changes made)
(198 real changes made)
(38,812 missing values generated)
(27,092 missing values generated)
(59 real changes made)
(65 real changes made)
(181 real changes made)
(182 real changes made)
(37,106 missing values generated)
(25,198 missing values generated)
(79 real changes made)
(82 real changes made)
(200 real changes made)
(200 real changes made)
(38,920 missing values generated)
(28,847 missing values generated)
(63 real changes made)
(63 real changes made)
(160 real changes made)
(163 real changes made)
(39,551 missing values generated)
(30,142 missing values generated)
(56 real changes made)
(56 real changes made)
(150 real changes made)
(150 real changes made)
(39,519 missing values generated)
(30,039 missing values generated)
(50 real changes made)
(54 real changes made)
(151 real changes made)
(151 real changes made)

. 
. display "Tabstat income after final toggle (final log series)"
Tabstat income after final toggle (final log series)

. tabstat `labfinal' `totfinal', statistics(n mean sd p1 p5 p50 p95 p99 min max)

   Stats |  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..
---------+----------------------------------------------------------------------
       N |         0      5656      7455      6122      5377      8692      7574
    Mean |         .  10.30657  10.32789  10.29953  10.25389  10.33693  10.29682
      SD |         .  1.207532  1.242578  1.205352  1.253909  1.226673  1.236754
      p1 |         .  6.113587   5.88222  6.348031  6.154457  6.208641  6.157207
      p5 |         .  8.010707  7.961661  7.896844  7.831103  7.818079  7.766645
     p50 |         .  10.53644  10.53808  10.51788  10.47016  10.55892   10.4747
     p95 |         .  11.90253  11.95065  11.87653  11.90864  11.92072  11.94103
     p99 |         .  12.53792  12.56683  12.50201  12.51323  12.51856  12.59496
     Min |         .  6.113587   5.88222  6.348031  6.154457  6.208641  6.157207
     Max |         .  12.53792  12.56683  12.50201  12.51323  12.51856  12.59496
--------------------------------------------------------------------------------

   Stats |  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_tot..  ln_tot..
---------+----------------------------------------------------------------------
       N |      6422      8128      6314      5683      5715         0     17802
    Mean |  10.29062  10.42369  10.36327  10.35685  10.29709         .   10.3305
      SD |  1.269907  1.236941  1.278543  1.304186  1.343301         .  1.091179
      p1 |  6.126628  6.112824  5.838223  5.956546  5.626906         .  6.401269
      p5 |  7.736066  7.817572  7.677074  7.646652  7.524026         .  8.752645
     p50 |  10.50866  10.64003  10.59484  10.64238  10.56855         .  10.33703
     p95 |  11.95557  12.03975  12.00781  12.02868  11.97837         .  12.07802
     p99 |  12.56438   12.7329  12.66525  12.58975  12.62997         .  12.94617
     Min |  6.126628  6.112824  5.838223  5.956546  5.626906         .  6.401269
     Max |  12.56438   12.7329  12.66525  12.58975  12.62997         .  12.94617
--------------------------------------------------------------------------------

   Stats |  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..
---------+----------------------------------------------------------------------
       N |     19702     18145     16893     21267     19872     18142     20036
    Mean |  10.36498  10.34426  10.34267  10.30732  10.26767  10.28541  10.31847
      SD |  1.146772  1.101013  1.077016  1.145028  1.135624  1.129346  1.207727
      p1 |  5.995548  6.378161  6.675921  5.950518  6.157207  6.116578   5.74176
      p5 |  8.697868  8.772313  8.778893  8.511226  8.470732  8.590482  8.394441
     p50 |     10.39  10.35043  10.32299  10.34266  10.27836  10.27717  10.35174
     p95 |  12.17453  12.10526  12.12784  12.05869  12.04609  12.04236  12.15069
     p99 |  13.03007  13.02674  12.99652   12.8689    12.885  12.92984  13.05799
     Min |  5.995548  6.378161  6.675921  5.950518  6.157207  6.116578   5.74176
     Max |  13.03007  13.02674  12.99652   12.8689    12.885  12.92984  13.05799
--------------------------------------------------------------------------------

   Stats |  ln_tot..  ln_tot..  ln_tot..
---------+------------------------------
       N |     16387     15092     15195
    Mean |  10.29318  10.33712  10.26756
      SD |  1.198123  1.122652  1.180377
      p1 |  5.779954   6.53799  5.814768
      p5 |  8.394914  8.570911  8.440317
     p50 |  10.30904  10.34315  10.25514
     p95 |  12.13142  12.13191   12.1272
     p99 |  13.04541  13.03812  12.98706
     Min |  5.779954   6.53799  5.814768
     Max |  13.04541  13.03812  12.98706
----------------------------------------

. 
. * ---------------------------------------------------------------------
. * Income growth from final log series (two-year differences)
. * ---------------------------------------------------------------------
. display "=== Income growth from final log series ==="
=== Income growth from final log series ===

. local labgrowth ""

. local totgrowth ""

. foreach y of local years {
  2.     if `y' > 2000 {
  3.         local yprev = `y' - 2
  4.         capture drop ln_lab_inc_final_growth_`y' ln_tot_inc_final_growth_`y'
  5.         gen double ln_lab_inc_final_growth_`y' = ln_lab_inc_final_`y' - ln_l
> ab_inc_final_`yprev' ///
>             if !missing(ln_lab_inc_final_`y') & !missing(ln_lab_inc_final_`ypre
> v')
  6.         gen double ln_tot_inc_final_growth_`y' = ln_tot_inc_final_`y' - ln_t
> ot_inc_final_`yprev' ///
>             if !missing(ln_tot_inc_final_`y') & !missing(ln_tot_inc_final_`ypre
> v')
  7.         local labgrowth "`labgrowth' ln_lab_inc_final_growth_`y'"
  8.         local totgrowth "`totgrowth' ln_tot_inc_final_growth_`y'"
  9.     }
 10. }
(45,234 missing values generated)
(45,234 missing values generated)
(41,181 missing values generated)
(29,527 missing values generated)
(39,900 missing values generated)
(27,959 missing values generated)
(40,766 missing values generated)
(29,237 missing values generated)
(41,465 missing values generated)
(30,727 missing values generated)
(38,759 missing values generated)
(26,528 missing values generated)
(39,795 missing values generated)
(28,106 missing values generated)
(40,915 missing values generated)
(30,211 missing values generated)
(39,965 missing values generated)
(29,766 missing values generated)
(40,897 missing values generated)
(31,926 missing values generated)
(41,897 missing values generated)
(33,790 missing values generated)

. display "Tabstat income growth (final log series)"
Tabstat income growth (final log series)

. tabstat `labgrowth' `totgrowth', statistics(n mean sd p1 p5 p50 p95 p99 min max
> )

   Stats |  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_lab..
---------+----------------------------------------------------------------------
       N |         0      4053      5334      4468      3769      6475      5439
    Mean |         . -.1429289 -.1031356 -.0872598 -.1264834 -.0925507 -.0719397
      SD |         .  .9657784   .911197  .8806459  .9786179  .9229774  .9302759
      p1 |         . -3.489464 -3.360654 -3.102295 -3.442393 -3.270309 -3.301414
      p5 |         . -1.926748 -1.674255 -1.614554 -1.871923 -1.671291 -1.704555
     p50 |         .  -.049046 -.0255963 -.0231814 -.0130246 -.0514336 -.0305789
     p95 |         .  1.203717  1.187946  1.128181  1.150126    1.2295  1.245367
     p99 |         .  2.833358  2.608142  2.565348  2.849176  2.761977  2.718293
     Min |         . -5.374762 -5.707975 -5.189705 -5.537481 -5.443937  -5.55204
     Max |         .  4.856229  5.203041  5.289735  4.948821  6.386318  5.396332
--------------------------------------------------------------------------------

   Stats |  ln_lab..  ln_lab..  ln_lab..  ln_lab..  ln_tot..  ln_tot..  ln_tot..
---------+----------------------------------------------------------------------
       N |      4319      5269      4337      3337         0     15707     17275
    Mean |   -.04305 -.0510101 -.0636506 -.1797528         .   -.03419 -.0295765
      SD |  .9628025  .9891444  1.010097  1.088492         .  .9075703  .9021985
      p1 | -3.607374  -3.45963 -3.511662 -3.965656         . -2.927442 -2.736664
      p5 | -1.687781 -1.636277 -1.719902 -2.242889         . -1.371335 -1.389236
     p50 |  .0200969 -.0227742 -.0051038 -.0875345         . -.0276421 -.0219873
     p95 |   1.27978  1.356611  1.304579   1.31479         .  1.337248  1.316816
     p99 |  2.779403  3.113966  3.138322  3.135471         .  2.885679  2.996703
     Min | -5.149603 -6.278488 -5.711742 -5.975253         . -6.177522 -6.472375
     Max |  5.531373  6.330444  6.308239  5.418638         .  6.628801  6.962202
--------------------------------------------------------------------------------

   Stats |  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..  ln_tot..
---------+----------------------------------------------------------------------
       N |     15997     14507     18706     17128     15023     15468     13308
    Mean | -.0225448  -.082139 -.0479558  .0089777 -.0109261 -.0402931 -.0011245
      SD |  .8645664  .9196312   .959586  .9139084   .953803  1.004548  .9654691
      p1 | -2.704798 -3.074015 -3.130587 -2.930167 -3.172961 -3.281307 -2.883053
      p5 |  -1.34834  -1.54242 -1.497045 -1.375947 -1.474992 -1.548862 -1.508524
     p50 | -.0151958 -.0055339 -.0324708 -.0000509  .0037397 -.0361586  .0011931
     p95 |  1.295843  1.219119  1.418742   1.39454   1.37249  1.481554  1.472878
     p99 |  2.765785  2.629835  3.068891  2.911552  2.974359  3.247155  3.197782
     Min | -5.698322 -7.046001 -6.711689 -6.445858 -6.411553 -7.015934 -5.964835
     Max |  5.958491  6.157117  6.934482  6.216496  6.941412  6.702273  7.258164
--------------------------------------------------------------------------------

   Stats |  ln_tot..
---------+----------
       N |     11444
    Mean | -.0932386
      SD |  .9818397
      p1 | -3.239303
      p5 | -1.648588
     p50 | -.0657595
     p95 |   1.39584
     p99 |  2.946323
     Min |  -7.22335
     Max |  5.913481
--------------------

. 
. save "${PROCESSED}/analysis_ready_processed.dta", replace
file /Volumes/SSD
    PRO/Github-forks/Chp2-TrustandReturns/Code/Processing/analysis_ready_proces
    > sed.dta saved

. display "04_processing_income: Saved ${PROCESSED}/analysis_ready_processed.dta"
04_processing_income: Saved /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Co
> de/Processing/analysis_ready_processed.dta

. 
. log close
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Notes/Logs/04_pro
> cessing_income.log
  log type:  text
 closed on:  17 Feb 2026, 16:11:16
---------------------------------------------------------------------------------
