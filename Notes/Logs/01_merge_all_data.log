--------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Notes/Logs/01_merge_all_data.log
  log type:  text
 opened on:   5 Feb 2026, 11:58:43

. 
. * ------------------------------------------------------------------------------
. * 1. FRED CPI
. * ------------------------------------------------------------------------------
. capture mkdir "${FRED_DATA}"

. freduse CPIAUCSL, clear

. export delimited using "${FRED_DATA}/CPIAUCSL.csv", replace
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/FRED/CPIAUCSL.csv saved

. display "Saved FRED CPIAUCSL to ${FRED_DATA}/CPIAUCSL.csv"
Saved FRED CPIAUCSL to /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/FRED/CPIAUCSL.csv

. clear

. 
. * ------------------------------------------------------------------------------
. * 2. Merge 2022 flows (01_1), then 2020 trust (01_2), then 2002–2020 flows (01_3–01_12)
. * ------------------------------------------------------------------------------
. * Run sub-scripts without capture so the first real error surfaces (which script/command failed)
. display "=== 01_1: Merging 2022 flows ==="
=== 01_1: Merging 2022 flows ===

. do "${RAW_DATA}/01_1_merge_flow_2022.do"

. * 01_1_merge_flow_2022.do
. * Merge 2022 flow variables from h22e3a into RAND longitudinal.
. * Variable names from old repo (Chp2-BeliefsandTrust_Old): h22e3a uses lowercase (hhidpn, sr050, sr073, etc.
> ).
. * Scratch file in RAW_DATA. Final output to CLEANED.
. 
. * Do not use -clear all-: it wipes globals (RAW_DATA, CLEANED) set by 00_config.
. clear

. set more off

. local scratch "${RAW_DATA}/_merge_scratch.dta"

. capture mkdir "${CLEANED}"

. 
. * Load longitudinal
. use "${HRS_DATA}/_randhrs1992_2022v1.dta", clear

. 
. * Load 2022 fat file: h22e3a uses lowercase. Flow vars + flag vars. Public stock: SR072 (flag), SR073 (amoun
> t).
. preserve

. use hhidpn sr050 sr055 sr063 sr064 sr072 sr073 sr030 sr035 sr045 sq171_1 sq171_2 sq171_3 sr007 sr013 sr024 /
> //
>     sr049 sr061 sr062 sr028 sr029 sq170_1 sq170_2 sq170_3 sr002 using "${HRS_DATA}/h22e3a.dta", clear

. save "`scratch'", replace
(file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta not found)
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta saved

. restore

. 
. merge 1:1 hhidpn using "`scratch'", nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                        29,378
        from master                    29,378  
        from using                          0  

    Matched                            15,856  
    -----------------------------------------

. capture erase "`scratch'"

. * Special-value recode and flag-based 0 fill done in 02_process_flows.do (processing step).
. 
. capture mkdir "${CLEANED}"

. save "${CLEANED}/all_data_merged.dta", replace
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Cleaned data/all_data_merged.dta saved

. display "01_1: Merged 2022 flows. Saved " _N " obs to all_data_merged.dta"
01_1: Merged 2022 flows. Saved 45234 obs to all_data_merged.dta

. 
end of do-file

. 
. display "=== 01_2: Merging 2020 trust (rv557-rv570) ==="
=== 01_2: Merging 2020 trust (rv557-rv570) ===

. do "${RAW_DATA}/01_2_merge_trust_2020.do"

. * 01_2_merge_trust_2020.do
. * Merge 2020 trust (rv557-rv570) from h20f1a. Uses project scratch file.
. * Merge key: hhidpn (per long_merge_in_trust_2020.do in old repo). Input: ${CLEANED}/all_data_merged.dta
. 
. * Do not use -clear all-: it wipes globals (RAW_DATA, CLEANED) set by 00_config.
. clear

. set more off

. 
. local scratch "${RAW_DATA}/_merge_scratch.dta"

. use "${CLEANED}/all_data_merged.dta", clear

. 
. preserve

. use hhidpn rv557 rv558 rv559 rv560 rv561 rv562 rv563 rv564 rv565 rv566 rv567 rv568 rv569 rv570 using "${HRS_
> DATA}/h20f1a.dta", clear

. rename (rv557 rv558 rv559 rv560 rv561 rv562 rv563 rv564 rv565 rv566 rv567 rv568 rv569 rv570) ///
>        (rv557_2020 rv558_2020 rv559_2020 rv560_2020 rv561_2020 rv562_2020 rv563_2020 rv564_2020 ///
>         rv565_2020 rv566_2020 rv567_2020 rv568_2020 rv569_2020 rv570_2020)

. save "`scratch'", replace
(file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta not found)
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta saved

. restore

. 
. merge 1:1 hhidpn using "`scratch'", nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                        29,511
        from master                    29,511  
        from using                          0  

    Matched                            15,723  
    -----------------------------------------

. capture erase "`scratch'"

. 
. * Recode HRS special values to missing for r557-r570 (trust). Per codebook RV570: -8 Web non-response, 8 DK/
> NA, 9 RF.
. * We remove -9 -8 8 9 98 99 (and 9998 ... 99999999) so 99 and all DK/NA/RF are missing for *r557-*r570.
. local trustvars rv557_2020 rv558_2020 rv559_2020 rv560_2020 rv561_2020 rv562_2020 rv563_2020 rv564_2020 rv56
> 5_2020 rv566_2020 rv567_2020 rv568_2020 rv569_2020 rv570_2020

. local miss -9 -8 8 9 98 99 9998 9999 999998 999999 9999998 9999999 99999998 99999999

. foreach v of local trustvars {
  2.     foreach m of local miss {
  3.         quietly replace `v' = . if `v' == `m'
  4.     }
  5. }

. 
. save "${CLEANED}/all_data_merged.dta", replace
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Cleaned data/all_data_merged.dta saved

. display "01_2: Merged 2020 trust (rv557-rv570). Saved " _N " obs"
01_2: Merged 2020 trust (rv557-rv570). Saved 45234 obs

. 
end of do-file

. 
. display "=== 01_3–01_12: Merging 2002–2020 flows ==="
=== 01_3–01_12: Merging 2002–2020 flows ===

. do "${RAW_DATA}/01_3_merge_flow_2002.do"

. * 01_3_merge_flow_2002.do — merge 2002 flow vars from h02f2c (prefix H). Fat files use lowercase + hhidpn.
. local scratch "${RAW_DATA}/_merge_scratch.dta"

. use "${CLEANED}/all_data_merged.dta", clear

. preserve

. use hhidpn hr050 hr055 hr063 hr064 hr072 hr073 hr030 hr035 hr045 hq171_1 hq171_2 hq171_3 hr007 hr013 hr024 /
> //
>     hr049 hr061 hr062 hr028 hr029 hq170_1 hq170_2 hq170_3 hr002 using "${HRS_DATA}/h02f2c.dta", clear

. save "`scratch'", replace
(file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta not found)
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta saved

. restore

. merge 1:1 hhidpn using "`scratch'", nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                        27,069
        from master                    27,069  
        from using                          0  

    Matched                            18,165  
    -----------------------------------------

. capture erase "`scratch'"

. * Special-value recode and flag-based 0 fill done in 02_process_flows.do (processing step).
. 
. save "${CLEANED}/all_data_merged.dta", replace
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Cleaned data/all_data_merged.dta saved

. display "01_3: Merged 2002 flows. N = " _N
01_3: Merged 2002 flows. N = 45234

. 
end of do-file

. do "${RAW_DATA}/01_4_merge_flow_2004.do"

. * 01_4_merge_flow_2004.do — merge 2004 flow vars from h04f1c (prefix J). Fat files use lowercase + hhidpn.
. local scratch "${RAW_DATA}/_merge_scratch.dta"

. use "${CLEANED}/all_data_merged.dta", clear

. preserve

. use hhidpn jr050 jr055 jr063 jr064 jr072 jr073 jr030 jr035 jr045 jq171_1 jq171_2 jq171_3 jr007 jr013 jr024 /
> //
>     jr049 jr061 jr062 jr028 jr029 jq170_1 jq170_2 jq170_3 jr002 using "${HRS_DATA}/h04f1c.dta", clear

. save "`scratch'", replace
(file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta not found)
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Raw data/_merge_scratch.dta saved

. restore

. merge 1:1 hhidpn using "`scratch'", nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                        25,105
        from master                    25,105  
        from using                          0  

    Matched                            20,129  
    -----------------------------------------

. capture erase "`scratch'"

. * Special-value recode and flag-based 0 fill done in 02_process_flows.do (processing step).
. 
. save "${CLEANED}/all_data_merged.dta", replace
file /Volumes/SSD PRO/Github-forks/Chp2-TrustandReturns/Code/Cleaned data/all_data_merged.dta saved

. display "01_4: Merged 2004 flows. N = " _N
01_4: Merged 2004 flows. N = 45234

. 
end of do-file

. do "${RAW_DATA}/01_5_merge_flow_2006.do"

. * 01_5_merge_flow_2006.do — merge 2006 flow vars from h06f4b (prefix K). Fat files use lowercase + hhidpn.
. local scratch "${RAW_DATA}/_merge_scratch.dta"

